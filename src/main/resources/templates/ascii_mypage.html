<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚´ ì‘í’ˆ | MacGyver</title>

    <style>
        body {
          margin: 0;
          padding: 0;
          font-family: Arial, sans-serif;
          background: #f5f5f5;
        }

        .container {
          max-width: 900px;
          margin: 20px auto 40px;
          padding: 0 16px;
        }


    h1 {
          margin-bottom: 6px;
        }

        .sub-text {
          color: #666;
          font-size: 14px;
          margin-bottom: 18px;
        }

        /* â”€â”€â”€â”€â”€ ìƒë‹¨ ì•¡ì…˜ ì˜ì—­ â”€â”€â”€â”€â”€ */
        .top-actions {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 10px;
          flex-wrap: wrap;
          margin-bottom: 14px;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          display: inline-block;
          padding: 8px 14px;
          border-radius: 6px;
          text-decoration: none;
          border: none;
          cursor: pointer;
          font-size: 14px;
        }

        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0069d9; }

        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }

        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }

        /* â”€â”€â”€â”€â”€ ì¹´ë“œ ë°•ìŠ¤ â”€â”€â”€â”€â”€ */
        .card {
          background: #fff;
          border-radius: 10px;
          padding: 14px 14px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.08);
          margin-bottom: 14px;
        }

        .card-title {
          font-size: 15px;
          font-weight: bold;
          margin-bottom: 8px;
        }

        /* â”€â”€â”€â”€â”€ íƒˆí‡´ ì˜ì—­ â”€â”€â”€â”€â”€ */
        .danger-card {
          border: 1px solid rgba(220,53,69,0.35);
          background: #fff;
        }

        .danger-hint {
          margin-top: 6px;
          color: #666;
          font-size: 13px;
          line-height: 1.4;
        }

        .withdraw-row {
          display: flex;
          gap: 10px;
          flex-wrap: wrap;
          align-items: center;
        }

        .withdraw-row input {
          padding: 8px 10px;
          border: 1px solid #ccc;
          border-radius: 6px;
          width: 190px;
        }

        /* â”€â”€â”€â”€â”€ ê²€ìƒ‰/ì •ë ¬ ì˜ì—­ â”€â”€â”€â”€â”€ */
        .search-bar {
          display: flex;
          gap: 10px;
          align-items: center;
          flex-wrap: wrap;
          margin: 10px 0 10px;
        }

        .search-bar input[type="text"] {
          padding: 8px 10px;
          border: 1px solid #ccc;
          border-radius: 6px;
          min-width: 240px;
        }

        /* â”€â”€â”€â”€â”€ ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ â”€â”€â”€â”€â”€ */
        .ascii-list {
          display: flex;
          flex-direction: column;
          gap: 12px;
          margin-top: 10px;
        }

        .ascii-item {
          background: #ffffff;
          border-radius: 10px;
          padding: 12px 12px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        .ascii-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
          gap: 10px;
        }

        .ascii-title a {
          font-weight: bold;
          font-size: 16px;
          color: #333;
          text-decoration: none;
        }
        .ascii-title a:hover { text-decoration: underline; }

        .badge {
          font-size: 12px;
          padding: 4px 8px;
          border-radius: 999px;
          border: 1px solid #ddd;
          color: #555;
          white-space: nowrap;
        }

        .badge.public { border-color: rgba(40,167,69,0.35); color: #218838; }
        .badge.private { border-color: rgba(108,117,125,0.35); color: #6c757d; }

        .ascii-preview {
          margin-top: 8px;
          background: #111;
          color: #0f0;
          border-radius: 8px;
          padding: 10px;
          font-family: "Consolas", "Courier New", monospace;
          font-size: 11px;
          line-height: 1.1;
          white-space: pre;
          max-height: 220px;
          overflow: auto;
        }

        .empty-message {
          margin-top: 16px;
          color: #777;
        }

        /* â”€â”€â”€â”€â”€ í˜ì´ì§• â”€â”€â”€â”€â”€ */
        .paging {
          margin-top: 22px;
          display: flex;
          gap: 8px;
          justify-content: center;
          flex-wrap: wrap;
        }

        .page-btn {
          display: inline-block;
          padding: 8px 12px;
          border-radius: 6px;
          background: #6c757d;
          color: white;
          text-decoration: none;
          font-size: 13px;
        }
        .page-btn:hover { background: #5a6268; }
        .page-btn.active {
          font-weight: bold;
          border: 2px solid #333;
          background: #495057;
        }
    </style>
</head>

<body>

<div th:replace="~{navbar :: navbar}"></div>

<div class="container">

    <h1>ë‚´ ASCII ì‘í’ˆ</h1>
    <div class="sub-text">
        ë‚´ê°€ ì˜¬ë¦° ì‘í’ˆë§Œ ëª¨ì•„ì„œ ê´€ë¦¬í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤. (ê³µê°œ/ë¹„ê³µê°œ ëª¨ë‘ í¬í•¨)
    </div>

    <div class="top-actions">
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a th:href="@{/ascii/list}" class="btn-secondary">ğŸŒ ì „ì²´ ê°¤ëŸ¬ë¦¬</a>

        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a th:href="@{/ascii/create}" class="btn-primary">âœ ë‚´ ì‘í’ˆ ì˜¬ë¦¬ê¸°</a>
            <a th:href="@{/ascii/art}" class="btn-secondary">ğŸ–¼ ì´ë¯¸ì§€ â†’ ASCII ë³€í™˜ê¸°</a>
        </div>
    </div>

    <a th:href="@{/withdraw}" class="btn-danger">ğŸš¨ íšŒì› íƒˆí‡´</a>

    <div class="card">
        <div class="card-title">ğŸ” ë‚´ ì‘í’ˆ ê²€ìƒ‰</div>

        <form class="search-bar" th:action="@{/ascii/my}" method="get">
            <input type="text" name="kw" placeholder="ê²€ìƒ‰ (ì œëª©/ë‚´ìš©)" th:value="${kw}"/>

            <input type="hidden" name="sort" th:value="${sort}">
            <input type="hidden" name="dir" th:value="${dir}">

            <button type="submit" class="btn-secondary">ê²€ìƒ‰</button>

            <a class="btn-secondary" th:href="@{/ascii/my(page=0, kw=${kw}, sort='createDate', dir='desc')}">ìµœì‹ ìˆœ</a>
            <a class="btn-secondary" th:href="@{/ascii/my(page=0, kw=${kw}, sort='createDate', dir='asc')}">ì˜¤ë˜ëœìˆœ</a>
            <a class="btn-secondary" th:href="@{/ascii/my(page=0, kw=${kw}, sort='subject', dir='asc')}">ì œëª© Aâ†’Z</a>
            <a class="btn-secondary" th:href="@{/ascii/my(page=0, kw=${kw}, sort='subject', dir='desc')}">ì œëª© Zâ†’A</a>
        </form>
    </div>

    <!-- ë¹„ì—ˆì„ ë•Œ -->
    <div th:if="${paging.totalElements == 0}" class="empty-message">
        ì•„ì§ ì˜¬ë¦° ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì˜ â€œë‚´ ì‘í’ˆ ì˜¬ë¦¬ê¸°â€ë¡œ ì²« ì‘í’ˆì„ ë“±ë¡í•´ë³´ì„¸ìš”!
    </div>

    <!-- ìˆì„ ë•Œ -->
    <div th:if="${paging.totalElements > 0}" class="ascii-list">
        <div class="ascii-item" th:each="art : ${paging.content}">
            <div class="ascii-header">
                <div class="ascii-title">
                    <a th:href="@{|/ascii/detail/${art.id}|}" th:text="${art.subject}">ì œëª©</a>
                </div>

                <span class="badge public" th:if="${art.public}">ê³µê°œ</span>
                <span class="badge private" th:if="${!art.public}">ë¹„ê³µê°œ</span>
            </div>

            <pre class="ascii-preview" th:text="${art.content}">ë¯¸ë¦¬ë³´ê¸°</pre>
        </div>
    </div>

    <!-- í˜ì´ì§• -->
    <div class="paging" th:if="${paging.totalPages > 1}">
        <a class="page-btn"
           th:if="${paging.hasPrevious()}"
           th:href="@{/ascii/my(page=${paging.number-1}, kw=${kw}, sort=${sort}, dir=${dir})}">
            ì´ì „
        </a>

        <a class="page-btn"
           th:each="p : ${#numbers.sequence(0, paging.totalPages-1)}"
           th:href="@{/ascii/my(page=${p}, kw=${kw}, sort=${sort}, dir=${dir})}"
           th:text="${p+1}"
           th:classappend="${p == paging.number} ? ' active' : ''">
        </a>

        <a class="page-btn"
           th:if="${paging.hasNext()}"
           th:href="@{/ascii/my(page=${paging.number+1}, kw=${kw}, sort=${sort}, dir=${dir})}">
            ë‹¤ìŒ
        </a>
    </div>

</div>

<script>
    function getCsrfTokenFromCookie() {
      const cookie = document.cookie.split('; ').find(row => row.startsWith('XSRF-TOKEN='));
      return cookie ? cookie.split('=')[1] : null;
    }

    async function ensureLoggedInAndShowWithdraw() {
      try {
        const res = await fetch("/api/auth/me", { method: "GET", credentials: "include" });
        if (res.ok) {
          document.getElementById("withdrawCard").style.display = "block";
        }
      } catch (e) {}
    }
</script>

</body>
</html>
