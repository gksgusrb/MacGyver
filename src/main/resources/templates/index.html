<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MacGyver 사이트</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }

        /* 상단 네비바 */
        .navbar {
            width: 100%;
            height: 60px;
            background: #222;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .navbar .title {
            font-size: 22px;
            font-weight: bold;
        }

        .navbar .nav-buttons a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            font-size: 16px;
        }

        .navbar .nav-buttons a:hover {
            text-decoration: underline;
        }

        /* 메인 콘텐츠 */
        .content {
            margin-top: 50px;
            text-align: center;
        }

        .content h1 {
            font-size: 38px;
            font-weight: bold;
        }

        .content p {
            margin-top: 15px;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>

<body>

<div class="navbar">
    <div class="title">MacGyver 사이트</div>

    <div class="nav-buttons" id="nav-user-area">
        <!-- JS가 로그인 상태에 따라 자동으로 채움 -->
    </div>
</div>

<div class="content">
    <h1>MacGyver 사이트에 오신 것을 환영합니다!</h1>
    <p>여기는 계산기, 단위변환기, 아스키 아트 등 다양한 기능을 제공할 예정입니다.</p>
</div>
<script>
    async function checkLoginStatus() {
        const area = document.getElementById("nav-user-area");

        try {
            const res = await fetch("/api/auth/me", {
                method: "GET",
                credentials: "include"
            });

            if (!res.ok) throw new Error();  // 로그인 안된 경우 catch로 이동

            const text = await res.text();
            const email = text.replace("현재 로그인한 사용자: ", "");

            // 로그인 상태 UI
            area.innerHTML = `
                <span style="margin-right: 15px; font-weight: bold;">${email} 님</span>
                <button onclick="logout()" style="
                    background:#ff6060;
                    border:none;
                    color:white;
                    padding:6px 10px;
                    border-radius:5px;
                    cursor:pointer;
                ">로그아웃</button>
            `;
        } catch (e) {
            // 비로그인 상태 UI
            area.innerHTML = `
                <a href="/login">로그인</a>
                <a href="/newbody">회원가입</a>
            `;
        }
    }

async function logout() {
    const token = document.cookie
        .split("; ")
        .find(v => v.startsWith("XSRF-TOKEN="))
        ?.split("=")[1];

    await fetch("/api/auth/logout", {
        method: "POST",
        headers: {
            "X-XSRF-TOKEN": token
        },
        credentials: "include"
    });

    location.href = "/";
}

    window.onload = checkLoginStatus;
</script>
</body>
</html>